# アセンブル
このソース一式を使用して改造版ff3を作るには
まず以下の二つを用意する必要があります
1.	nesasm [(fork)](https://github.com/camsaul/nesasm) | [(original)](http://www.magicengine.com/mkit/)
2.	iNESヘッダ(先頭10hバイト)を削ったパッチをあてたいff3

[2]をbase-binaryフォルダに ff3_hack_base.nes という名前で置き
以下のいずれかのバージョンをnesasmでアセンブルしてください。
`nesasm xxx.asm`
-	ff3_hack.asm
-	ff3_hack_beta.asm
-	ff3_hack_another.asm
-	ff3_hack_soundtest.asm
-	ff3_hack_encounter.asm
-	ff3_hack_noitem99.asm

上手くいけば、同じフォルダに <アセンブルしたファイル>.nes という名前でパッチが適用されたff3が出来上がります。


# ベースにするff3について

オリジナルである必要はありません。
必要な部分を上書きする形になっているため、
モンスターデータ・アイテムデータ・マップデータ等
パッチ適用部分以外はそのまま残ります。


# 各ファイルの説明など (ff3_hack_master.asm) 

パッチに実装されている機能ごとにおおまかにわけてありますが、
オリジナルのコードを最適化して出来たスペースに
新しいコードを埋め込むという形で実装されているものも多いため
分離が簡単にできないファイルも多々あります（・ω・｀）
配置アドレスへの依存性も高いのでファイルの順番を変えた場合テストが必要です。


## アセンブルフラグの説明

BETA
-------------------------------------------------
	拡張的な機能をパッチに含めます

TEST_COUNTER_ATTACK
-------------------------------------------------
	カウンターを100%発動にします

EXPERIMENTAL
-------------------------------------------------
	実験的なコードをパッチに含めます

EXPERIMENT_IMPL
-------------------------------------------------
	実装する実験コードを指定します
-	0-3:古い実装のままのため動作しません
-	4:サウンドテスト
-	5:エンカウントテスト

FIX_DUNGEON_FLOOR_SAVE
-------------------------------------------------
	階層移動バグに対処します

FIX_ATTR_BOOST
-------------------------------------------------
	属性ボーナスが適用されるようにします

FIX_HP_GROW
-------------------------------------------------
	HP上昇処理が9bit精度で行われるように修正します

FIX_ITEM99
-------------------------------------------------
	itemが99個のときに起きるバグを修正します

EXTEND_GEOMANCE
-------------------------------------------------
	「ちけい」で発動する技が地形と確率によりランダムになります
	但しまだ実装中のため色々と問題があります

BOOST_GEOMANCER
-------------------------------------------------
	「ちけい」の威力が熟練度により上昇しやすくなります

BOOST_CHEER
-------------------------------------------------
	「おうえん」の効果が強化されます

BOOST_INTIMIDATE
-------------------------------------------------
	「おどかす」の効果が強化されます

BOOST_CHARGE
-------------------------------------------------
	「ためる」の効果が強化されます

CHARGE_COUNT_JUMP
-------------------------------------------------
	「ジャンプ」の攻撃力追加率を16分率で指定します

CHARGE_INCREMENT
-------------------------------------------------
	「ためる」1回ごとの攻撃力追加率を16分率で指定します

CHARGE_MAX
-------------------------------------------------
	「ためる」ことができる最大の攻撃力増加率を16分率で指定します
	この値を超えた場合自爆します

PROVOKE_CRITICAL_RATE
-------------------------------------------------
	「ちょうはつ」された時に設定されるクリティカル率です

COUNTER_CRITICAL_RATE
-------------------------------------------------
	カウンター発動時のクリティカル率です

SCHOLAR_ITEM_EFFECT_DOUBLE
-------------------------------------------------
	学者のアイテム効果(魔法攻撃回数)が2倍になります

GIVE_FIGHTER_RAID
-------------------------------------------------
	戦士が「ふみこむ」を使えるようになります

GIVE_HUNTER_DISORDERED_SHOT
-------------------------------------------------
	狩人が「みだれうち」を使えるようになります

GIVE_VIKING_PROVOKE
-----------------------------------
	バイキングが「ちょうはつ」を使えるようになります

GIVE_EVILSWORDMAN_ABYSS
-----------------------------------
	魔剣士が「あんこく」を使えるようになります

ENABLE_EXTRA_ABILITY
ENABLE_EXTRA_ABILITY_TAG
-----------------------------------
	パッシブ能力の実装を有効にします(基本的に二つセットで必要)

VARIABLE_SWING_FRAMES
-----------------------------------
	打撃モーションの速度を可変にします

SWING_FRAME_COUNT = 6
-----------------------------------
	可変にしない場合の打撃モーションのフレーム数です
	8にするとオリジナル版と同じになります

REDRAW_ON_EQUIP_CHANGE
-----------------------------------
	定義されている場合
	アイテムウインドウで装備を変更した際に即座に再描画します(オリジナルと同じ動作)

CONTINUE_ON_EQUIP_CHANGE
-----------------------------------
	定義されている場合
	アイテムウインドウで装備を変更した際にウインドウを閉じません

USE_ITOA8
-----------------------------------
	定義されている場合
	アイテムの個数を表示する際に最適化されたルーチンを使用します
	なおこのルーチンはバグがあり3桁の数を正しく表示できません

GIVE_VIKING_PROVOKE
-----------------------------------
	定義されている場合バイキングに「ちょうはつ」が実装されます

COMMAND_WINDOW_WIDTH
-----------------------------------
	コマンド入力ウインドウの文字幅を指定します
	オリジナルは5です

RANDOM_LCG_A
-----------------------------------
	戦闘用乱数列の生成に使用する線形合同法の漸化式の係数を指定します
	オリジナルは3です
	8で割って3余る数である必要があります
	この乱数はダメージ計算・ドロップ判定等に使われます
	オリジナルでは生成される乱数の並びがまずいため
	ドロップ率が"1"に設定されているモンスター(=3色ドラゴン以外全て)は
	3番目のアイテムまでしか落としません
